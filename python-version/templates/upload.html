{% extends "base.html" %}

{% block title %}Upload Transactions - MindfulMoney{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Upload Bank Statement</h2>
    <p>Upload a CSV file exported from your banking app</p>
</div>

<div class="upload-container">
    <form method="POST" enctype="multipart/form-data" class="upload-form" id="uploadForm">
        <div class="file-input-wrapper" id="dropZone">
            <input type="file" name="file" id="file" accept=".csv" required>
            <label for="file" class="file-label">
                <span class="file-icon">üìÅ</span>
                <span class="file-text" id="fileText">Choose CSV file or drag & drop here</span>
            </label>
        </div>
        
        <button type="submit" class="btn btn-primary">Upload & Import</button>
    </form>

    <div class="upload-info">
        <h3>Supported Formats</h3>
        <p>Your CSV file should contain columns for:</p>
        <ul>
            <li><strong>Date</strong> or <strong>Posting Date</strong> - Transaction date</li>
            <li><strong>Description</strong> - Transaction details</li>
            <li><strong>Money In / Money Out</strong> or <strong>Amount</strong> - Transaction amount</li>
            <li><strong>Balance</strong> (optional) - Account balance</li>
            <li><strong>Category</strong> (optional) - Transaction category</li>
        </ul>
        <p class="note">The app will automatically detect column names from your bank's format.</p>
    </div>
</div>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('file');
    const fileText = document.getElementById('fileText');
    const uploadForm = document.getElementById('uploadForm');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Highlight drop zone when dragging over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        dropZone.classList.add('drag-over');
    }

    function unhighlight(e) {
        dropZone.classList.remove('drag-over');
    }

    // Handle dropped files
    dropZone.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            fileInput.files = files;
            updateFileName(files[0].name);
        }
    }

    // Update file name when selected via input
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            updateFileName(this.files[0].name);
        }
    });

    function updateFileName(name) {
        fileText.textContent = name;
        fileText.style.color = '#27ae60';
    }
</script>
{% endblock %}
